# playwright-e2e-coverage-report

## Description

As playwright end2end test report structure (json) and code coverage report structure (json) i.e of `statement`, `branch`, `function` mapping of code coverage are not directly compatible with e2e report generated by playwright. 

Therefore, this package tries to fill the gap in a hacky way. Use it in a `CI` pipeline where playwright e2e test reports are needed to be squeezed into a format acceptable for code coverage places like [codecov](https://about.codecov.io/). Here e2e tests are considered to be equivalent of `function` and will are put under `fnMap` key. 

> **NOTE**: Only supports playwright json reporter, and is not the best solution. 

---

## Usage

Follow the steps below to integrate it in your test pipeline.

### Step 1

In your `CI` pipeline eg. github actions, add a step after the playwright test report is generated.

> Place **after** the step that generates playwright e2e test report.

```
- name: Convert E2E Report to Coverage Report
	run : |
	npm install playwright-e2e-report
	node ./tests/reportConvertor.js
```

The playwright report (**`e2eresults.json`**) is currently read from project root and needs to be found there and the second command in this step's run has to have an entrypoint script from [step 2](#step-2), more control with environment variable in next patch.

### Step 2

1. Create `reportConvertor.js` your projects `tests/` folder
2. Add the following content to it
  
	```js
   #!/usr/bin/env node
   // Entry point to script for playwright e2e test report conversion
   // to a coverage friendly format ( a bit hacky for now)

   import fs from 'fs'
   import { createE2ECoverageReport } from 'playwright-e2e-report'

   reportConvertor();

   function reportConvertor (){
    var data = {}
    try {
    	// read from e2e results file at project root
    	data = JSON.parse(fs.readFileSync('./e2eresults.json', 'utf8'));
    } catch (err) {
    	console.log("error in reporting coversion", err)
    } finally {
    	// calls playwright-e2e-report package
    	createE2ECoverageReport({ ...data })
    	console.log("==== Report Converted for Coverage ====")
    }
    return 0
    }
	```
